<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board.mapper.GroupMapper">
    
	<select id="selectGroup" resultType="board.dto.GroupDto">
		<![CDATA[
			SELECT
				groupIdx,
				createId,
                name,
                count,
				DATE_FORMAT(createdDatetime, '%Y.%m.%d %H:%i:%s') AS createdDatetime
			FROM
				t_group
			WHERE
				group_idx = #{groupIdx}
                <if test="category != null and categorey != ''" >
                    AND category = #{category}
                </if>
		]]>
	</select>
	
	<insert id="insertGroup" parameterType="board.dto.GroupDto" useGeneratedKeys="true" keyProperty="groupIdx">
		<![CDATA[
			INSERT INTO t_group
			(
				create_id,
				fastJoin,
                group_name,
                introdution,
                created_datetime,
                people_max,
                catetory
			) 
			VALUES 
			(
				'dbsl215', 
				'0', 
                #{groupName}, 
                #{introdution}, 
				NOW(), 
				#{peopleMax},
				#{category}			
			)
		]]>
	</insert>
    
    <select id="selectMyListGroup" parameterType="board.dto.UserRelationGroupDto" resultType="board.dto.GroupDto">
		<![CDATA[
			SELECT
				groupIdx
			FROM
				t_userRelationGroup
			WHERE
				user_idx = #{userIdx}
		]]>
	</select>
    
    <select id="selectMyListGroupByIdx" parameterType="map" resultType="board.dto.GroupDto">
		<![CDATA[
			SELECT
				groupIdx,
				createId,
                name,
                count,
                introdution
			FROM
				t_group
			WHERE
				group_idx IN
                <foreach collection="list" item="groupDto" open="(" separator="," close=")"> 
                #{group_idx}
                </foreach>
		]]>
	</select>
    
	
	<update id="updateGroup" parameterType="board.dto.GroupDto">
		<![CDATA[
			UPDATE t_group SET
	            createId = #{create_id}, 
				fastJoin = '0', 
                name = #{name}, 
                introdution = #{introdution}
			WHERE 
				group_idx = #{groupIdx}
		]]>
	</update>
	
	<insert id="enterGroup" parameterType="board.dto.UserRelationGroupDto">
        <![CDATA[
			INSERT INTO t_userRelationGroup
			(
				group_idx,
				user_id,
                enter_date_time
			) 
			VALUES 
			(
				#{groupIdx}, 
				#{userId}, 
				NOW()	
			)
		]]>
	</insert>
	
	<delete id="secedeGroup" parameterType="board.dto.UserRelationGroupDto">
		   <![CDATA[
			DELETE FROM t_userRelationGroup
            WHERE
				group_idx = #{groupIdx}
            AND
				user_idx = #{userIdx}
		]]>
	</delete>
	
</mapper>